<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>CineVerse — Discover Movies & TV</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@700;800;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#06060b;--bg2:#0c0c14;--bg3:#14141f;--bg4:#1c1c2e;--bg5:#24243a;
--surface:rgba(18,18,30,.85);--surface2:rgba(28,28,46,.9);--surface3:rgba(36,36,58,.9);
--red:#e50914;--red2:#ff2030;--red-glow:rgba(229,9,20,.35);--red-soft:rgba(229,9,20,.08);
--gold:#fbbf24;--gold2:#f59e0b;--gold-glow:rgba(251,191,36,.2);
--cyan:#06b6d4;--cyan2:#22d3ee;--cyan-glow:rgba(6,182,212,.15);
--green:#10b981;--green2:#34d399;--green-glow:rgba(16,185,129,.15);
--purple:#8b5cf6;--purple2:#a78bfa;
--pink:#ec4899;
--text:#f0f0f5;--text2:#9ca3af;--text3:#4b5563;
--font:'Outfit',sans-serif;
--font-display:'Playfair Display',serif;
--font-mono:'JetBrains Mono',monospace;
--radius:10px;--radius-sm:6px;--radius-lg:16px;--radius-xl:24px;
--ease:cubic-bezier(.4,0,.2,1);--bounce:cubic-bezier(.34,1.56,.64,1);--spring:cubic-bezier(.175,.885,.32,1.275);
--shadow:0 8px 32px rgba(0,0,0,.6);--shadow-lg:0 20px 60px rgba(0,0,0,.7);
--glass:rgba(255,255,255,.03);--glass-border:rgba(255,255,255,.06);
--nav-h:60px;--mobile-nav-h:68px;
}
html{scroll-behavior:smooth;-webkit-tap-highlight-color:transparent}
body{font-family:var(--font);background:var(--bg);color:var(--text);overflow-x:hidden;min-height:100vh;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--red)}
img{display:block;max-width:100%}
button{font-family:var(--font);cursor:pointer;border:none;outline:none;background:none;color:var(--text);-webkit-tap-highlight-color:transparent}
input,select,textarea{font-family:var(--font);outline:none;border:none;background:none;color:var(--text)}
a{text-decoration:none;color:inherit}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}

/* ===== NOISE TEXTURE ===== */
body::before{content:'';position:fixed;inset:0;z-index:9999;pointer-events:none;opacity:.015;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E")}

/* ===== LOADING SCREEN ===== */
#loader{position:fixed;inset:0;background:var(--bg);z-index:10000;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .8s ease,visibility .8s ease}
#loader.hidden{opacity:0;visibility:hidden;pointer-events:none}
.loader-brand{position:relative;margin-bottom:32px}
.loader-brand svg{width:48px;height:48px;animation:loader-spin 2s linear infinite}
@keyframes loader-spin{to{transform:rotate(360deg)}}
.loader-title{font-family:var(--font-display);font-size:2.8rem;font-weight:900;background:linear-gradient(135deg,var(--red),var(--red2),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:1px}
.loader-bar{width:180px;height:2px;background:var(--bg3);border-radius:2px;overflow:hidden;margin-top:20px}
.loader-bar-inner{height:100%;width:0;background:linear-gradient(90deg,var(--red),var(--red2));border-radius:2px;animation:loader-fill 1.8s var(--ease) forwards}
@keyframes loader-fill{0%{width:0}100%{width:100%}}
.loader-text{margin-top:14px;font-size:.8rem;color:var(--text3);letter-spacing:3px;text-transform:uppercase;animation:loader-pulse 1.5s ease-in-out infinite}
@keyframes loader-pulse{0%,100%{opacity:.4}50%{opacity:1}}

/* ===== AUTH OVERLAY ===== */
.auth-overlay{position:fixed;inset:0;background:rgba(6,6,11,.92);backdrop-filter:blur(40px);z-index:9000;display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:all .4s var(--ease);padding:20px}
.auth-overlay.active{opacity:1;visibility:visible}
.auth-modal{background:var(--bg2);border:1px solid var(--glass-border);border-radius:var(--radius-xl);padding:40px 32px;width:min(440px,100%);transform:translateY(40px) scale(.92);transition:transform .5s var(--spring);position:relative;overflow:hidden}
.auth-modal::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--red),var(--pink),var(--purple))}
.auth-overlay.active .auth-modal{transform:translateY(0) scale(1)}
.auth-close{position:absolute;top:16px;right:16px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:var(--bg3);font-size:16px;transition:all .3s var(--ease);z-index:1}
.auth-close:hover{background:var(--red);transform:rotate(90deg)}
.auth-brand{text-align:center;margin-bottom:28px}
.auth-brand-title{font-family:var(--font-display);font-size:2rem;font-weight:900;background:linear-gradient(135deg,var(--red),var(--red2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.auth-brand-sub{color:var(--text2);font-size:.85rem;margin-top:6px}
.auth-tabs{display:flex;gap:4px;background:var(--bg);border-radius:var(--radius);padding:4px;margin-bottom:24px}
.auth-tab{flex:1;padding:10px;text-align:center;border-radius:var(--radius-sm);font-weight:600;font-size:.88rem;transition:all .3s var(--ease);color:var(--text3);cursor:pointer}
.auth-tab.active{background:var(--red);color:#fff}
.auth-field{margin-bottom:16px;position:relative}
.auth-field label{display:block;font-size:.75rem;color:var(--text2);margin-bottom:6px;font-weight:600;text-transform:uppercase;letter-spacing:1.5px}
.auth-field input{width:100%;padding:14px 16px;background:var(--bg);border:2px solid var(--bg4);border-radius:var(--radius);font-size:.95rem;transition:all .3s var(--ease)}
.auth-field input:focus{border-color:var(--red);box-shadow:0 0 0 4px var(--red-glow)}
.auth-field input::placeholder{color:var(--text3)}
.auth-btn{width:100%;padding:16px;background:linear-gradient(135deg,var(--red),var(--red2));color:#fff;border-radius:var(--radius);font-size:.95rem;font-weight:700;letter-spacing:.5px;transition:all .3s var(--ease);margin-top:8px;text-transform:uppercase;position:relative;overflow:hidden}
.auth-btn::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent,rgba(255,255,255,.1));opacity:0;transition:opacity .3s}
.auth-btn:hover::after{opacity:1}
.auth-btn:hover{transform:translateY(-2px);box-shadow:0 8px 30px var(--red-glow)}
.auth-btn:active{transform:translateY(0)}
.auth-btn:disabled{opacity:.5;pointer-events:none}
.auth-divider{display:flex;align-items:center;gap:14px;margin:22px 0;color:var(--text3);font-size:.78rem;text-transform:uppercase;letter-spacing:1px}
.auth-divider::before,.auth-divider::after{content:'';flex:1;height:1px;background:var(--bg4)}
.auth-google{width:100%;padding:14px;border:2px solid var(--bg4);border-radius:var(--radius);font-size:.9rem;font-weight:600;transition:all .3s var(--ease);display:flex;align-items:center;justify-content:center;gap:10px}
.auth-google:hover{border-color:var(--text3);background:var(--bg3)}
.auth-error{background:rgba(229,9,20,.12);border:1px solid rgba(229,9,20,.25);border-radius:var(--radius-sm);padding:12px 14px;color:var(--red2);font-size:.85rem;margin-bottom:16px;display:none;animation:shake .4s}
.auth-error.show{display:flex;align-items:center;gap:8px}
.auth-forgot{text-align:right;margin-top:-8px;margin-bottom:12px}
.auth-forgot a{font-size:.8rem;color:var(--text3);transition:color .2s}
.auth-forgot a:hover{color:var(--red)}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}

/* ===== NAVBAR ===== */
.navbar{position:fixed;top:0;left:0;right:0;z-index:5000;height:var(--nav-h);display:flex;align-items:center;padding:0 clamp(16px,4vw,40px);transition:all .4s var(--ease)}
.navbar::after{content:'';position:absolute;inset:0;background:linear-gradient(to bottom,var(--bg),transparent);opacity:1;transition:opacity .4s;z-index:-1}
.navbar.scrolled::after{opacity:0}
.navbar.scrolled{background:rgba(6,6,11,.92);backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid var(--glass-border)}
.nav-inner{width:100%;max-width:1440px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:16px}
.nav-logo{display:flex;align-items:center;gap:8px;cursor:pointer;flex-shrink:0}
.nav-logo-text{font-family:var(--font-display);font-size:1.5rem;font-weight:900;background:linear-gradient(135deg,var(--red),var(--red2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;transition:all .3s}
.nav-logo:hover .nav-logo-text{filter:brightness(1.2)}
.nav-links{display:flex;align-items:center;gap:6px}
.nav-link{font-size:.88rem;font-weight:500;color:var(--text2);transition:all .3s var(--ease);padding:8px 14px;border-radius:var(--radius);position:relative}
.nav-link:hover{color:var(--text);background:var(--glass)}
.nav-link.active{color:#fff;font-weight:600}
.nav-link.active::after{content:'';position:absolute;bottom:2px;left:50%;transform:translateX(-50%);width:16px;height:2px;background:var(--red);border-radius:1px}
.nav-right{display:flex;align-items:center;gap:8px}
.nav-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;background:var(--glass);border:1px solid var(--glass-border);transition:all .3s var(--ease);flex-shrink:0}
.nav-btn:hover{background:var(--bg4);border-color:rgba(255,255,255,.1);transform:scale(1.08)}
.nav-btn svg{width:18px;height:18px}
.nav-avatar{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--red),var(--purple));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85rem;cursor:pointer;transition:all .3s var(--ease);border:2px solid transparent;flex-shrink:0}
.nav-avatar:hover{border-color:var(--red);transform:scale(1.08);box-shadow:0 0 20px var(--red-glow)}

/* Profile Dropdown */
.profile-dd{position:absolute;top:calc(100% + 12px);right:0;width:260px;background:var(--bg2);border:1px solid var(--glass-border);border-radius:var(--radius-lg);box-shadow:var(--shadow-lg);overflow:hidden;opacity:0;visibility:hidden;transform:translateY(-8px) scale(.96);transition:all .3s var(--spring);z-index:6000}
.profile-dd.active{opacity:1;visibility:visible;transform:translateY(0) scale(1)}
.profile-dd-head{padding:18px 16px;background:linear-gradient(135deg,var(--red-soft),rgba(139,92,246,.06));border-bottom:1px solid var(--glass-border);display:flex;align-items:center;gap:12px}
.profile-dd-avatar{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,var(--red),var(--purple));display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1rem;flex-shrink:0}
.profile-dd-name{font-weight:700;font-size:.95rem}
.profile-dd-email{font-size:.75rem;color:var(--text2);margin-top:2px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:160px}
.profile-dd-item{padding:12px 16px;display:flex;align-items:center;gap:12px;font-size:.88rem;font-weight:500;transition:all .2s var(--ease);cursor:pointer;color:var(--text2)}
.profile-dd-item:hover{background:var(--glass);color:var(--text)}
.profile-dd-item svg{width:18px;height:18px;flex-shrink:0;opacity:.6}
.profile-dd-item.danger{color:var(--red)}
.profile-dd-item.danger svg{opacity:1}
.profile-dd-sep{height:1px;background:var(--glass-border);margin:4px 0}

/* ===== MOBILE NAV ===== */
.mobile-nav{position:fixed;bottom:0;left:0;right:0;z-index:5000;background:rgba(6,6,11,.96);backdrop-filter:blur(24px) saturate(180%);border-top:1px solid var(--glass-border);padding:6px 0 max(6px,env(safe-area-inset-bottom));display:none}
.mobile-nav-inner{display:flex;align-items:center;justify-content:space-around;max-width:500px;margin:0 auto}
.mob-item{display:flex;flex-direction:column;align-items:center;gap:3px;padding:6px 10px;color:var(--text3);font-size:.62rem;font-weight:600;transition:all .2s var(--ease);letter-spacing:.3px;position:relative;-webkit-tap-highlight-color:transparent}
.mob-item svg{width:22px;height:22px;transition:all .3s var(--ease)}
.mob-item.active{color:var(--text)}
.mob-item.active svg{color:var(--red)}
.mob-item.active::before{content:'';position:absolute;top:-6px;width:20px;height:2px;background:var(--red);border-radius:1px}
.mob-search-btn{position:relative;margin-top:-16px}
.mob-search-btn .mob-search-circle{width:50px;height:50px;background:linear-gradient(135deg,var(--red),var(--red2));border-radius:50%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 24px var(--red-glow);transition:all .3s var(--ease)}
.mob-search-btn:active .mob-search-circle{transform:scale(.9)}
.mob-search-btn svg{color:#fff !important}

/* ===== SEARCH OVERLAY ===== */
.search-overlay{position:fixed;inset:0;background:rgba(6,6,11,.96);backdrop-filter:blur(40px);z-index:8000;display:flex;flex-direction:column;opacity:0;visibility:hidden;transition:all .35s var(--ease);transform:scale(1.02)}
.search-overlay.active{opacity:1;visibility:visible;transform:scale(1)}
.search-top{padding:12px 16px;display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--glass-border)}
.search-field{flex:1;position:relative;display:flex;align-items:center}
.search-field svg{position:absolute;left:14px;color:var(--text3);width:18px;height:18px;pointer-events:none}
.search-field input{width:100%;padding:13px 16px 13px 44px;background:var(--bg3);border:2px solid transparent;border-radius:50px;font-size:1rem;transition:all .3s var(--ease)}
.search-field input:focus{border-color:var(--red);background:var(--bg2);box-shadow:0 0 0 4px var(--red-glow)}
.search-field input::placeholder{color:var(--text3)}
.search-x{width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:all .3s;flex-shrink:0;font-size:18px;color:var(--text2)}
.search-x:hover{color:var(--text);background:var(--bg4)}
.search-chips{padding:10px 16px;display:flex;gap:8px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.search-chips::-webkit-scrollbar{display:none}
.chip{padding:7px 18px;border-radius:50px;font-size:.8rem;font-weight:600;background:var(--bg3);color:var(--text2);transition:all .25s var(--ease);white-space:nowrap;flex-shrink:0;border:1px solid transparent;cursor:pointer}
.chip.active{background:var(--red);color:#fff;border-color:var(--red)}
.chip:not(.active):hover{background:var(--bg4);border-color:var(--glass-border)}
.search-body{flex:1;overflow-y:auto;padding:16px;-webkit-overflow-scrolling:touch}
.search-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px}
.search-section-title{font-size:.8rem;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:2px;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.search-section-title::after{content:'';flex:1;height:1px;background:var(--bg4)}
.search-history{display:flex;flex-direction:column;gap:2px;margin-bottom:24px}
.search-history-item{padding:10px 14px;display:flex;align-items:center;gap:12px;border-radius:var(--radius);transition:all .2s;cursor:pointer;color:var(--text2);font-size:.9rem}
.search-history-item:hover{background:var(--glass);color:var(--text)}
.search-history-item svg{width:16px;height:16px;opacity:.5;flex-shrink:0}
.search-history-item .remove{margin-left:auto;opacity:0;transition:opacity .2s}
.search-history-item:hover .remove{opacity:.6}

/* ===== HERO ===== */
.hero{position:relative;height:92vh;min-height:520px;max-height:960px;overflow:hidden}
.hero-slide{position:absolute;inset:0;opacity:0;transition:opacity 1.2s ease}
.hero-slide.active{opacity:1}
.hero-slide img{width:100%;height:100%;object-fit:cover}
.hero-vignette{position:absolute;inset:0;background:
  linear-gradient(to right,rgba(6,6,11,.85) 0%,rgba(6,6,11,.3) 50%,rgba(6,6,11,.1) 100%),
  linear-gradient(to top,var(--bg) 0%,transparent 40%),
  linear-gradient(to bottom,rgba(6,6,11,.4) 0%,transparent 30%)}
.hero-content{position:absolute;bottom:18%;left:0;padding:0 clamp(16px,5vw,60px);max-width:680px;z-index:2}
.hero-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;border-radius:50px;font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:2px;margin-bottom:18px;backdrop-filter:blur(12px);animation:fadeUp .7s var(--ease) both}
.hero-badge.trending{background:rgba(229,9,20,.15);border:1px solid rgba(229,9,20,.3);color:var(--red2)}
.hero-badge.new{background:rgba(16,185,129,.12);border:1px solid rgba(16,185,129,.3);color:var(--green2)}
.hero-title{font-family:var(--font-display);font-size:clamp(2.2rem,6.5vw,4.5rem);font-weight:900;line-height:1.05;letter-spacing:-.5px;margin-bottom:14px;text-shadow:0 4px 30px rgba(0,0,0,.5);animation:fadeUp .7s .1s var(--ease) both}
.hero-meta{display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:12px;font-size:.88rem;animation:fadeUp .7s .2s var(--ease) both}
.hero-meta-item{display:flex;align-items:center;gap:5px;color:var(--text2)}
.hero-meta-item.rating{color:var(--gold);font-weight:700}
.hero-meta-item.rating svg{width:15px;height:15px}
.hero-meta-sep{width:3px;height:3px;border-radius:50%;background:var(--text3)}
.hero-genres{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px;animation:fadeUp .7s .25s var(--ease) both}
.hero-genre-tag{padding:4px 12px;border-radius:50px;font-size:.75rem;font-weight:600;background:rgba(255,255,255,.08);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.08);color:var(--text2)}
.hero-desc{font-size:.92rem;color:var(--text2);line-height:1.65;max-width:520px;margin-bottom:22px;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;animation:fadeUp .7s .3s var(--ease) both}
.hero-actions{display:flex;gap:10px;flex-wrap:wrap;animation:fadeUp .7s .35s var(--ease) both}
.btn-primary{padding:13px 28px;background:linear-gradient(135deg,var(--red),var(--red2));color:#fff;border-radius:50px;font-weight:700;font-size:.9rem;display:inline-flex;align-items:center;gap:8px;transition:all .3s var(--ease);letter-spacing:.3px;position:relative;overflow:hidden}
.btn-primary::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent 40%,rgba(255,255,255,.15));opacity:0;transition:opacity .3s}
.btn-primary:hover::before{opacity:1}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 30px var(--red-glow)}
.btn-primary:active{transform:translateY(0);box-shadow:0 4px 15px var(--red-glow)}
.btn-primary svg{width:18px;height:18px}
.btn-glass{padding:13px 24px;background:rgba(255,255,255,.08);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);color:#fff;border-radius:50px;font-weight:600;font-size:.9rem;display:inline-flex;align-items:center;gap:8px;transition:all .3s var(--ease)}
.btn-glass:hover{background:rgba(255,255,255,.15);border-color:rgba(255,255,255,.2);transform:translateY(-2px)}
.btn-glass:active{transform:translateY(0)}
.btn-glass svg{width:18px;height:18px}
.hero-progress{position:absolute;bottom:0;left:0;right:0;display:flex;gap:3px;padding:0 clamp(16px,5vw,60px);z-index:3}
.hero-prog-item{flex:1;height:3px;background:rgba(255,255,255,.15);border-radius:2px;cursor:pointer;overflow:hidden;transition:all .3s}
.hero-prog-item:hover{background:rgba(255,255,255,.25)}
.hero-prog-item.active .hero-prog-fill{animation:hero-timer 8s linear forwards}
.hero-prog-item.done .hero-prog-fill{width:100%}
.hero-prog-fill{height:100%;width:0;background:var(--red);border-radius:2px}
@keyframes hero-timer{to{width:100%}}

/* ===== SECTIONS ===== */
.section{padding:36px 0}
.section-head{display:flex;align-items:center;justify-content:space-between;padding:0 clamp(16px,5vw,60px);margin-bottom:18px}
.section-title{font-weight:800;font-size:1.25rem;letter-spacing:-.3px;display:flex;align-items:center;gap:10px}
.section-title .icon{width:20px;height:20px;color:var(--red)}
.section-see-all{font-size:.82rem;color:var(--text3);font-weight:600;display:flex;align-items:center;gap:4px;transition:all .3s;padding:6px 12px;border-radius:50px;border:1px solid transparent}
.section-see-all:hover{color:var(--text);border-color:var(--glass-border);background:var(--glass)}
.section-see-all svg{width:14px;height:14px;transition:transform .3s}
.section-see-all:hover svg{transform:translateX(3px)}

/* ===== CARD ROW ===== */
.row{display:flex;gap:12px;overflow-x:auto;padding:0 clamp(16px,5vw,60px) 8px;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;scroll-padding:0 clamp(16px,5vw,60px)}
.row::-webkit-scrollbar{display:none}

/* ===== CARD ===== */
.card{flex-shrink:0;width:155px;scroll-snap-align:start;cursor:pointer;position:relative;-webkit-tap-highlight-color:transparent;transition:transform .35s var(--ease)}
.card:hover{transform:translateY(-6px)}
.card:active{transform:scale(.97)}
.card-img{aspect-ratio:2/3;background:var(--bg3);border-radius:var(--radius);overflow:hidden;position:relative}
.card-img img{width:100%;height:100%;object-fit:cover;transition:all .5s var(--ease)}
.card:hover .card-img img{transform:scale(1.05)}
.card-img::after{content:'';position:absolute;inset:0;background:linear-gradient(to top,rgba(6,6,11,.8) 0%,transparent 50%);opacity:0;transition:opacity .3s}
.card:hover .card-img::after{opacity:1}
.card-rating{position:absolute;top:8px;right:8px;background:rgba(6,6,11,.75);backdrop-filter:blur(8px);padding:3px 8px;border-radius:50px;font-size:.72rem;font-weight:700;color:var(--gold);display:flex;align-items:center;gap:3px;z-index:1;border:1px solid rgba(251,191,36,.15)}
.card-rating svg{width:11px;height:11px}
.card-type-badge{position:absolute;top:8px;left:8px;padding:3px 8px;border-radius:4px;font-size:.62rem;font-weight:800;z-index:1;letter-spacing:.5px;text-transform:uppercase}
.card-type-badge.new{background:var(--green);color:#000}
.card-type-badge.hd{background:var(--red);color:#fff}
.card-wl{position:absolute;bottom:8px;right:8px;width:30px;height:30px;background:rgba(6,6,11,.7);backdrop-filter:blur(8px);border-radius:50%;display:flex;align-items:center;justify-content:center;z-index:2;opacity:0;transform:translateY(8px);transition:all .3s var(--ease);font-size:16px;border:1px solid rgba(255,255,255,.1)}
.card:hover .card-wl,.card-wl.in{opacity:1;transform:translateY(0)}
.card-wl.in{color:var(--red);border-color:rgba(229,9,20,.3)}
.card-wl:hover{background:var(--red);color:#fff;border-color:var(--red)}
.card-info{padding:10px 2px 2px}
.card-title{font-size:.84rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:1.3}
.card-sub{font-size:.72rem;color:var(--text3);margin-top:3px;display:flex;align-items:center;gap:6px}
.card-sub .dot{width:3px;height:3px;border-radius:50%;background:var(--text3)}

/* Wide card */
.card-w{width:290px}
.card-w .card-img{aspect-ratio:16/9}
.card-w .card-img img{object-position:center 20%}

/* Top 10 */
.card-t10{width:205px;display:flex;align-items:flex-end;gap:0}
.card-t10 .t10-num{font-family:var(--font-display);font-size:7.5rem;font-weight:900;line-height:.78;color:transparent;-webkit-text-stroke:2px rgba(255,255,255,.12);flex-shrink:0;margin-right:-18px;z-index:0;transition:all .3s}
.card-t10:hover .t10-num{-webkit-text-stroke-color:var(--red)}
.card-t10 .card-img{width:120px;flex-shrink:0;z-index:1}
.card-t10 .card-info{position:absolute;bottom:0;left:0;right:0;z-index:2}

/* ===== GENRE PILLS ===== */
.genre-scroll{display:flex;gap:8px;overflow-x:auto;padding:0 clamp(16px,5vw,60px) 12px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.genre-scroll::-webkit-scrollbar{display:none}
.g-pill{flex-shrink:0;padding:9px 20px;border-radius:50px;font-size:.82rem;font-weight:600;background:var(--bg3);border:1px solid var(--glass-border);transition:all .3s var(--ease);white-space:nowrap;cursor:pointer;color:var(--text2)}
.g-pill:hover{background:var(--bg4);border-color:rgba(255,255,255,.1);color:var(--text)}
.g-pill.active{background:var(--red);border-color:var(--red);color:#fff}

/* ===== DETAIL OVERLAY ===== */
.detail-overlay{position:fixed;inset:0;background:var(--bg);z-index:7000;overflow-y:auto;opacity:0;visibility:hidden;transition:all .4s var(--ease);-webkit-overflow-scrolling:touch;transform:translateY(20px)}
.detail-overlay.active{opacity:1;visibility:visible;transform:translateY(0)}
.detail-x{position:fixed;top:14px;right:14px;width:40px;height:40px;background:rgba(6,6,11,.7);backdrop-filter:blur(10px);border-radius:50%;display:flex;align-items:center;justify-content:center;z-index:7100;font-size:17px;transition:all .3s var(--ease);border:1px solid var(--glass-border)}
.detail-x:hover{background:var(--red);border-color:var(--red);transform:rotate(90deg)}
.detail-back{position:absolute;inset:0;width:100%;aspect-ratio:16/9;max-height:60vh;overflow:hidden}
.detail-back img{width:100%;height:100%;object-fit:cover}
.detail-back-grad{position:absolute;inset:0;background:
  linear-gradient(to top,var(--bg) 0%,rgba(6,6,11,.2) 50%,rgba(6,6,11,.5) 100%),
  linear-gradient(to right,rgba(6,6,11,.6),transparent 60%)}
.detail-inner{max-width:1100px;margin:0 auto;padding:0 clamp(16px,4vw,40px) 100px;position:relative;z-index:2}
.detail-top{display:flex;gap:28px;margin-top:-120px}
.detail-poster{flex-shrink:0;width:200px;border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-lg);border:1px solid var(--glass-border)}
.detail-poster img{width:100%;aspect-ratio:2/3;object-fit:cover}
.detail-head{flex:1;min-width:0;padding-top:40px}
.detail-title{font-family:var(--font-display);font-size:clamp(1.6rem,4.5vw,2.8rem);font-weight:900;line-height:1.1;margin-bottom:8px}
.detail-tagline{font-style:italic;color:var(--text3);font-size:.88rem;margin-bottom:14px}
.detail-tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:16px}
.dtag{padding:5px 12px;border-radius:50px;font-size:.76rem;font-weight:600;background:var(--bg3);border:1px solid var(--glass-border);color:var(--text2)}
.dtag.gold{background:rgba(251,191,36,.1);border-color:rgba(251,191,36,.2);color:var(--gold);display:flex;align-items:center;gap:4px}
.dtag.gold svg{width:13px;height:13px}
.dtag.green{background:rgba(16,185,129,.1);border-color:rgba(16,185,129,.2);color:var(--green2)}
.detail-btns{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:22px}
.detail-btns .btn-primary{padding:11px 22px;font-size:.85rem}
.dbtn-icon{width:42px;height:42px;border-radius:50%;background:var(--bg3);border:1.5px solid var(--glass-border);display:flex;align-items:center;justify-content:center;transition:all .3s var(--ease);font-size:15px}
.dbtn-icon:hover{background:var(--bg4);border-color:rgba(255,255,255,.15);transform:scale(1.1)}
.dbtn-icon.active{border-color:var(--red);color:var(--red);background:var(--red-soft)}
.dbtn-icon svg{width:18px;height:18px}
.detail-overview{font-size:.93rem;line-height:1.75;color:var(--text2);margin-bottom:28px;max-width:700px}
.detail-overview.clamped{display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden}
.detail-overview-toggle{color:var(--red);font-size:.84rem;font-weight:600;cursor:pointer;margin-top:6px;display:inline-block}

/* Stats Grid */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-bottom:32px}
.stat-card{background:var(--bg3);border:1px solid var(--glass-border);border-radius:var(--radius);padding:14px 16px;transition:all .3s}
.stat-card:hover{border-color:rgba(255,255,255,.08);background:var(--bg4)}
.stat-label{font-size:.68rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--text3);margin-bottom:5px;font-weight:600}
.stat-val{font-size:1rem;font-weight:700}
.stat-val.money{color:var(--green2)}
.stat-val.providers{display:flex;gap:5px;flex-wrap:wrap;margin-top:4px}
.stat-val.providers img{width:28px;height:28px;border-radius:6px}

/* Countdown */
.countdown{background:linear-gradient(135deg,var(--red-soft),rgba(139,92,246,.06));border:1px solid rgba(229,9,20,.15);border-radius:var(--radius-lg);padding:22px;margin-bottom:28px;text-align:center;position:relative;overflow:hidden}
.countdown::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at center,rgba(229,9,20,.08),transparent 70%)}
.countdown-label{font-size:.72rem;text-transform:uppercase;letter-spacing:3px;color:var(--red2);font-weight:700;margin-bottom:14px}
.countdown-grid{display:flex;justify-content:center;gap:20px}
.cd-unit{display:flex;flex-direction:column;align-items:center}
.cd-num{font-family:var(--font-mono);font-size:2.2rem;font-weight:600;color:var(--text);line-height:1;min-width:48px;text-align:center}
.cd-txt{font-size:.6rem;text-transform:uppercase;letter-spacing:2px;color:var(--text3);margin-top:6px;font-weight:600}

/* Detail Section Title */
.d-sec-title{font-weight:800;font-size:1.1rem;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.d-sec-title::after{content:'';flex:1;height:1px;background:var(--glass-border)}

/* Cast */
.cast-scroll{display:flex;gap:14px;overflow-x:auto;padding-bottom:8px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.cast-scroll::-webkit-scrollbar{display:none}
.cast-item{flex-shrink:0;width:90px;text-align:center;cursor:pointer;transition:transform .3s}
.cast-item:hover{transform:translateY(-4px)}
.cast-pic{width:72px;height:72px;border-radius:50%;overflow:hidden;margin:0 auto 8px;background:var(--bg4);border:2px solid var(--glass-border);transition:border-color .3s}
.cast-item:hover .cast-pic{border-color:var(--red)}
.cast-pic img{width:100%;height:100%;object-fit:cover}
.cast-name{font-size:.76rem;font-weight:600;line-height:1.2;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.cast-char{font-size:.68rem;color:var(--text3);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

/* Seasons */
.season-tabs{display:flex;gap:6px;overflow-x:auto;margin-bottom:14px;padding-bottom:6px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.season-tabs::-webkit-scrollbar{display:none}
.s-tab{padding:8px 18px;border-radius:50px;font-size:.8rem;font-weight:600;background:var(--bg3);color:var(--text2);transition:all .25s var(--ease);white-space:nowrap;flex-shrink:0;cursor:pointer;border:1px solid transparent}
.s-tab:hover{background:var(--bg4)}
.s-tab.active{background:var(--red);color:#fff;border-color:var(--red)}
.ep-list{display:flex;flex-direction:column;gap:8px}
.ep-card{display:flex;gap:14px;background:var(--bg3);border:1px solid var(--glass-border);border-radius:var(--radius);padding:10px;transition:all .3s var(--ease);cursor:pointer}
.ep-card:hover{background:var(--bg4);border-color:rgba(255,255,255,.06);transform:translateX(4px)}
.ep-still{width:130px;aspect-ratio:16/9;border-radius:var(--radius-sm);overflow:hidden;background:var(--bg4);flex-shrink:0;position:relative}
.ep-still img{width:100%;height:100%;object-fit:cover}
.ep-num{position:absolute;top:4px;left:6px;background:rgba(0,0,0,.75);padding:2px 7px;border-radius:4px;font-size:.65rem;font-weight:700}
.ep-body{flex:1;min-width:0}
.ep-title{font-weight:600;font-size:.88rem;margin-bottom:3px}
.ep-meta{font-size:.72rem;color:var(--text3);margin-bottom:5px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.ep-desc{font-size:.78rem;color:var(--text2);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}

/* Videos */
.vid-scroll{display:flex;gap:14px;overflow-x:auto;padding-bottom:8px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.vid-scroll::-webkit-scrollbar{display:none}
.vid-card{flex-shrink:0;width:250px;cursor:pointer;transition:transform .3s}
.vid-card:hover{transform:translateY(-4px)}
.vid-thumb{width:100%;aspect-ratio:16/9;border-radius:var(--radius);overflow:hidden;position:relative;background:var(--bg3)}
.vid-thumb img{width:100%;height:100%;object-fit:cover}
.vid-play{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);transition:background .3s}
.vid-play svg{width:44px;height:44px;color:#fff;filter:drop-shadow(0 2px 10px rgba(0,0,0,.5));transition:transform .3s}
.vid-card:hover .vid-play{background:rgba(229,9,20,.2)}
.vid-card:hover .vid-play svg{transform:scale(1.15)}
.vid-name{font-size:.78rem;font-weight:600;margin-top:8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.vid-type{font-size:.68rem;color:var(--text3);margin-top:2px}

/* Reviews */
.review{background:var(--bg3);border:1px solid var(--glass-border);border-radius:var(--radius);padding:16px;margin-bottom:10px}
.review-top{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.review-av{width:36px;height:36px;border-radius:50%;background:var(--bg5);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.82rem;flex-shrink:0}
.review-author{font-weight:600;font-size:.88rem}
.review-date{font-size:.72rem;color:var(--text3)}
.review-score{margin-left:auto;color:var(--gold);font-weight:700;font-size:.85rem;display:flex;align-items:center;gap:4px;background:var(--gold-glow);padding:4px 10px;border-radius:50px}
.review-score svg{width:13px;height:13px}
.review-body{font-size:.84rem;color:var(--text2);line-height:1.65;display:-webkit-box;-webkit-line-clamp:5;-webkit-box-orient:vertical;overflow:hidden}

/* Similar Row */
.similar-row{display:flex;gap:12px;overflow-x:auto;padding-bottom:8px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.similar-row::-webkit-scrollbar{display:none}

/* ===== TRAILER MODAL ===== */
.trailer-overlay{position:fixed;inset:0;background:rgba(0,0,0,.96);z-index:9500;display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:all .3s var(--ease);padding:20px}
.trailer-overlay.active{opacity:1;visibility:visible}
.trailer-box{width:min(960px,100%);aspect-ratio:16/9;position:relative}
.trailer-box iframe{width:100%;height:100%;border:none;border-radius:var(--radius-lg)}
.trailer-x{position:absolute;top:-48px;right:0;width:38px;height:38px;background:rgba(255,255,255,.08);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;transition:all .3s;color:var(--text2)}
.trailer-x:hover{background:var(--red);color:#fff}

/* ===== PERSON MODAL ===== */
.person-overlay{position:fixed;inset:0;background:var(--bg);z-index:7500;overflow-y:auto;opacity:0;visibility:hidden;transition:all .4s var(--ease);-webkit-overflow-scrolling:touch;transform:translateY(20px)}
.person-overlay.active{opacity:1;visibility:visible;transform:translateY(0)}
.person-inner{max-width:900px;margin:0 auto;padding:80px clamp(16px,4vw,40px) 100px}
.person-top{display:flex;gap:28px;margin-bottom:32px}
.person-photo{width:180px;flex-shrink:0;border-radius:var(--radius-lg);overflow:hidden;background:var(--bg3)}
.person-photo img{width:100%;aspect-ratio:2/3;object-fit:cover}
.person-name{font-family:var(--font-display);font-size:2.2rem;font-weight:900;margin-bottom:8px}
.person-dept{font-size:.88rem;color:var(--text2);margin-bottom:14px}
.person-bio{font-size:.9rem;color:var(--text2);line-height:1.7;display:-webkit-box;-webkit-line-clamp:8;-webkit-box-orient:vertical;overflow:hidden}
.person-stats{display:flex;gap:16px;flex-wrap:wrap;margin-top:16px}
.person-stat{font-size:.82rem;color:var(--text3)}
.person-stat strong{color:var(--text);font-weight:600}

/* ===== BROWSE PAGE ===== */
.browse-page{display:none;padding:calc(var(--nav-h) + 20px) clamp(16px,5vw,60px) 120px}
.browse-top{margin-bottom:24px}
.browse-top h1{font-family:var(--font-display);font-size:clamp(1.6rem,4vw,2.4rem);font-weight:900;margin-bottom:4px}
.browse-top p{color:var(--text2);font-size:.88rem}
.browse-filters{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:20px}
.browse-select{padding:10px 36px 10px 14px;background:var(--bg3);border:1px solid var(--glass-border);border-radius:50px;font-size:.82rem;font-weight:600;color:var(--text);cursor:pointer;-webkit-appearance:none;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%239ca3af' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;transition:all .3s}
.browse-select:hover{border-color:rgba(255,255,255,.1)}
.browse-select:focus{border-color:var(--red);box-shadow:0 0 0 3px var(--red-glow)}
.browse-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(145px,1fr));gap:14px}
.load-more{display:flex;justify-content:center;margin-top:32px}
.load-more button{padding:12px 36px;background:var(--bg3);border:1.5px solid var(--glass-border);border-radius:50px;font-weight:600;font-size:.88rem;transition:all .3s var(--ease);color:var(--text2)}
.load-more button:hover{border-color:var(--red);color:var(--text);background:var(--red-soft)}

/* ===== WATCHLIST PAGE ===== */
.wl-page{display:none;padding:calc(var(--nav-h) + 20px) clamp(16px,5vw,60px) 120px}
.wl-head{margin-bottom:6px}
.wl-head h1{font-family:var(--font-display);font-size:clamp(1.6rem,4vw,2.4rem);font-weight:900}
.wl-count{color:var(--text2);font-size:.88rem;margin-bottom:24px}
.wl-tabs{display:flex;gap:6px;margin-bottom:20px}
.wl-tab{padding:8px 18px;border-radius:50px;font-size:.82rem;font-weight:600;background:var(--bg3);color:var(--text2);cursor:pointer;transition:all .25s;border:1px solid transparent}
.wl-tab.active{background:var(--red);color:#fff;border-color:var(--red)}
.wl-tab:not(.active):hover{background:var(--bg4)}
.wl-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(145px,1fr));gap:14px}
.wl-empty{text-align:center;padding:80px 20px}
.wl-empty svg{width:56px;height:56px;color:var(--text3);margin-bottom:14px;opacity:.5}
.wl-empty h3{font-size:1.15rem;margin-bottom:6px;font-weight:700}
.wl-empty p{color:var(--text3);font-size:.88rem;max-width:300px;margin:0 auto}

/* ===== RATINGS MODAL ===== */
.rate-overlay{position:fixed;inset:0;background:rgba(6,6,11,.9);backdrop-filter:blur(30px);z-index:8500;display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:all .3s;padding:20px}
.rate-overlay.active{opacity:1;visibility:visible}
.rate-modal{background:var(--bg2);border:1px solid var(--glass-border);border-radius:var(--radius-xl);padding:36px 32px;width:min(360px,100%);text-align:center;transform:scale(.9);transition:transform .4s var(--spring)}
.rate-overlay.active .rate-modal{transform:scale(1)}
.rate-title{font-weight:800;font-size:1.1rem;margin-bottom:4px}
.rate-subtitle{font-size:.82rem;color:var(--text3);margin-bottom:20px}
.rate-stars{display:flex;justify-content:center;gap:6px;margin-bottom:20px}
.rate-star{width:36px;height:36px;cursor:pointer;color:var(--bg5);transition:all .2s var(--ease)}
.rate-star.active,.rate-star:hover{color:var(--gold);transform:scale(1.15)}
.rate-star svg{width:100%;height:100%}
.rate-submit{padding:12px 28px;background:linear-gradient(135deg,var(--red),var(--red2));color:#fff;border-radius:50px;font-weight:700;font-size:.88rem;transition:all .3s}
.rate-submit:hover{transform:translateY(-2px);box-shadow:0 6px 20px var(--red-glow)}
.rate-clear{padding:8px 16px;color:var(--text3);font-size:.82rem;margin-left:8px;transition:color .2s}
.rate-clear:hover{color:var(--text)}

/* ===== TOAST ===== */
.toast-zone{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);z-index:9999;display:flex;flex-direction:column;gap:8px;align-items:center;pointer-events:none}
.toast{padding:12px 22px;background:var(--surface2);border:1px solid var(--glass-border);border-radius:50px;font-size:.88rem;font-weight:600;box-shadow:var(--shadow);pointer-events:auto;display:flex;align-items:center;gap:8px;animation:toast-in .4s var(--spring) forwards;backdrop-filter:blur(16px)}
.toast svg{width:16px;height:16px;flex-shrink:0}
.toast.success{border-color:rgba(16,185,129,.3);color:var(--green2)}
.toast.success svg{color:var(--green)}
.toast.error{border-color:rgba(229,9,20,.3);color:var(--red2)}
.toast.error svg{color:var(--red)}
.toast.info svg{color:var(--cyan)}
@keyframes toast-in{0%{opacity:0;transform:translateY(16px) scale(.9)}100%{opacity:1;transform:translateY(0) scale(1)}}
@keyframes toast-out{to{opacity:0;transform:translateY(-16px) scale(.9)}}

/* ===== SKELETON ===== */
.skel{background:linear-gradient(90deg,var(--bg3) 25%,var(--bg4) 50%,var(--bg3) 75%);background-size:200% 100%;animation:shimmer 1.8s ease-in-out infinite;border-radius:var(--radius)}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* ===== SCROLL REVEAL ===== */
.reveal{opacity:0;transform:translateY(24px);transition:all .6s var(--ease)}
.reveal.visible{opacity:1;transform:translateY(0)}

/* ===== BACK TO TOP ===== */
.btt{position:fixed;bottom:90px;right:16px;width:42px;height:42px;background:var(--surface2);border:1px solid var(--glass-border);backdrop-filter:blur(12px);border-radius:50%;display:flex;align-items:center;justify-content:center;z-index:4000;opacity:0;visibility:hidden;transform:translateY(10px);transition:all .3s var(--ease)}
.btt.show{opacity:1;visibility:visible;transform:translateY(0)}
.btt:hover{background:var(--red);border-color:var(--red)}
.btt svg{width:18px;height:18px}

/* ===== RESPONSIVE ===== */
@media(max-width:768px){
  .nav-links{display:none}
  .mobile-nav{display:block}
  body{padding-bottom:var(--mobile-nav-h)}
  .hero{height:78vh;min-height:440px}
  .hero-content{bottom:14%;max-width:100%}
  .hero-desc{-webkit-line-clamp:2;font-size:.85rem}
  .hero-actions .btn-primary,.hero-actions .btn-glass{padding:11px 20px;font-size:.84rem}
  .card{width:125px}
  .card-w{width:240px}
  .card-t10{width:170px}
  .card-t10 .t10-num{font-size:5.5rem}
  .card-t10 .card-img{width:100px}
  .section-title{font-size:1.1rem}
  .detail-top{flex-direction:column;align-items:center;text-align:center;margin-top:-80px}
  .detail-poster{width:160px}
  .detail-head{padding-top:16px}
  .detail-tags{justify-content:center}
  .detail-btns{justify-content:center}
  .detail-overview{text-align:left}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .cd-num{font-size:1.7rem}
  .ep-still{width:100px}
  .vid-card{width:210px}
  .person-top{flex-direction:column;align-items:center;text-align:center}
  .person-photo{width:150px}
  .browse-grid,.wl-grid{grid-template-columns:repeat(auto-fill,minmax(110px,1fr));gap:10px}
  .toast-zone{bottom:80px}
  .btt{bottom:80px;right:12px}
}
@media(max-width:380px){
  .card{width:110px}
  .hero-title{font-size:1.8rem}
  .hero-actions{flex-direction:column;width:100%}
  .hero-actions .btn-primary,.hero-actions .btn-glass{width:100%;justify-content:center}
}
@media(min-width:769px){
  .card-wl{opacity:0}
  .card:hover .card-wl{opacity:1}
}
@keyframes fadeUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>

<!-- LOADER -->
<div id="loader">
  <div class="loader-brand">
    <svg viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8" fill="var(--red)" stroke="none"/></svg>
  </div>
  <div class="loader-title">CineVerse</div>
  <div class="loader-bar"><div class="loader-bar-inner"></div></div>
  <div class="loader-text">Loading your universe</div>
</div>

<!-- AUTH -->
<div class="auth-overlay" id="authOverlay">
  <div class="auth-modal">
    <button class="auth-close" onclick="closeAuth()">✕</button>
    <div class="auth-brand">
      <div class="auth-brand-title">CineVerse</div>
      <div class="auth-brand-sub">Your personal movie universe</div>
    </div>
    <div class="auth-tabs">
      <div class="auth-tab active" onclick="switchAuth('login')">Sign In</div>
      <div class="auth-tab" onclick="switchAuth('signup')">Sign Up</div>
    </div>
    <div class="auth-error" id="authErr">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M15 9l-6 6M9 9l6 6"/></svg>
      <span id="authErrText"></span>
    </div>
    <div id="authNameField" style="display:none" class="auth-field">
      <label>Display Name</label>
      <input type="text" id="authName" placeholder="Your name">
    </div>
    <div class="auth-field">
      <label>Email</label>
      <input type="email" id="authEmail" placeholder="you@example.com" autocomplete="email">
    </div>
    <div class="auth-field">
      <label>Password</label>
      <input type="password" id="authPass" placeholder="••••••••" autocomplete="current-password">
    </div>
    <div class="auth-forgot" id="authForgot"><a href="#" onclick="resetPassword(event)">Forgot password?</a></div>
    <button class="auth-btn" id="authBtn" onclick="handleAuth()">Sign In</button>
    <div class="auth-divider">or</div>
    <button class="auth-google" onclick="handleGoogleAuth()">
      <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
      Continue with Google
    </button>
  </div>
</div>

<!-- NAVBAR -->
<nav class="navbar" id="navbar">
  <div class="nav-inner">
    <div class="nav-logo" onclick="goHome()">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="var(--red)" stroke-width="2.5" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8" fill="var(--red)" stroke="none"/></svg>
      <span class="nav-logo-text">CineVerse</span>
    </div>
    <div class="nav-links">
      <a class="nav-link active" data-page="home" onclick="showPage('home')">Home</a>
      <a class="nav-link" data-page="movies" onclick="showPage('movies')">Movies</a>
      <a class="nav-link" data-page="tv" onclick="showPage('tv')">TV Shows</a>
      <a class="nav-link" data-page="watchlist" onclick="showPage('watchlist')">My List</a>
    </div>
    <div class="nav-right">
      <button class="nav-btn" onclick="openSearch()" title="Search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      </button>
      <div style="position:relative">
        <div class="nav-avatar" id="navAv" onclick="toggleProfile()">?</div>
        <div class="profile-dd" id="profileDD">
          <div class="profile-dd-head">
            <div class="profile-dd-avatar" id="ddAv">?</div>
            <div><div class="profile-dd-name" id="ddName">Guest</div><div class="profile-dd-email" id="ddEmail">Sign in</div></div>
          </div>
          <div class="profile-dd-item" id="ddAuth" onclick="handleProfileAuth()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><path d="M10 17l5-5-5-5"/><path d="M15 12H3"/></svg>
            <span>Sign In</span>
          </div>
          <div class="profile-dd-item" onclick="showPage('watchlist');toggleProfile()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/></svg>
            My Watchlist
          </div>
          <div class="profile-dd-item" id="ddRated" onclick="showPage('watchlist');toggleProfile()" style="display:none">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            My Ratings
          </div>
          <div class="profile-dd-sep"></div>
          <div class="profile-dd-item" id="ddSignOut" onclick="auth.signOut();toggleProfile()" style="display:none">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
            Sign Out
          </div>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- MOBILE NAV -->
<div class="mobile-nav">
  <div class="mobile-nav-inner">
    <a class="mob-item active" data-page="home" onclick="showPage('home')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/></svg>Home</a>
    <a class="mob-item" data-page="movies" onclick="showPage('movies')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2.18"/><path d="M7 2v20M17 2v20M2 12h20M2 7h5M2 17h5M17 17h5M17 7h5"/></svg>Movies</a>
    <a class="mob-item mob-search-btn" onclick="openSearch()"><div class="mob-search-circle"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg></div>Search</a>
    <a class="mob-item" data-page="tv" onclick="showPage('tv')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="15" rx="2"/><polyline points="17 2 12 7 7 2"/></svg>TV</a>
    <a class="mob-item" data-page="watchlist" onclick="showPage('watchlist')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/></svg>My List</a>
  </div>
</div>

<!-- SEARCH OVERLAY -->
<div class="search-overlay" id="searchOv">
  <div class="search-top">
    <div class="search-field">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input id="searchIn" type="text" placeholder="Search movies, TV shows, people..." autocomplete="off">
    </div>
    <button class="search-x" onclick="closeSearch()">✕</button>
  </div>
  <div class="search-chips">
    <button class="chip active" data-f="multi" onclick="setFilter('multi',this)">All</button>
    <button class="chip" data-f="movie" onclick="setFilter('movie',this)">Movies</button>
    <button class="chip" data-f="tv" onclick="setFilter('tv',this)">TV Shows</button>
    <button class="chip" data-f="person" onclick="setFilter('person',this)">People</button>
  </div>
  <div class="search-body" id="searchBody">
    <div id="searchDefault">
      <div id="searchHistoryWrap"></div>
      <div class="search-section-title">Trending Now</div>
      <div class="search-grid" id="trendGrid"></div>
    </div>
    <div id="searchResultsWrap" style="display:none">
      <div class="search-grid" id="searchGrid"></div>
      <div id="searchEmpty" style="display:none;text-align:center;padding:60px 20px;color:var(--text3)">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin-bottom:12px;opacity:.4"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <p style="font-size:.95rem;font-weight:600">No results found</p>
        <p style="font-size:.82rem;margin-top:4px">Try a different search term</p>
      </div>
    </div>
  </div>
</div>

<!-- DETAIL OVERLAY -->
<div class="detail-overlay" id="detailOv">
  <button class="detail-x" onclick="closeDetail()">✕</button>
  <div id="detailContent"></div>
</div>

<!-- PERSON OVERLAY -->
<div class="person-overlay" id="personOv">
  <button class="detail-x" onclick="closePerson()">✕</button>
  <div class="person-inner" id="personContent"></div>
</div>

<!-- TRAILER -->
<div class="trailer-overlay" id="trailerOv" onclick="closeTrailer()">
  <div class="trailer-box" onclick="event.stopPropagation()">
    <button class="trailer-x" onclick="closeTrailer()">✕</button>
    <iframe id="trailerFrame" src="" allow="autoplay;encrypted-media" allowfullscreen></iframe>
  </div>
</div>

<!-- RATING MODAL -->
<div class="rate-overlay" id="rateOv" onclick="closeRating()">
  <div class="rate-modal" onclick="event.stopPropagation()">
    <div class="rate-title" id="rateTitle">Rate this</div>
    <div class="rate-subtitle" id="rateSub"></div>
    <div class="rate-stars" id="rateStars"></div>
    <div>
      <button class="rate-submit" onclick="submitRating()">Rate</button>
      <button class="rate-clear" onclick="clearRating()">Remove</button>
    </div>
  </div>
</div>

<!-- HOME -->
<main id="homePage"><div class="hero" id="heroWrap"></div><div id="homeRows"></div></main>

<!-- BROWSE -->
<div class="browse-page" id="moviesPage">
  <div class="browse-top"><h1>Movies</h1><p>Discover your next favorite film</p></div>
  <div class="genre-scroll" id="mGenres"></div>
  <div class="browse-filters">
    <select class="browse-select" id="mSort" onchange="loadMovies()"><option value="popularity.desc">Popular</option><option value="vote_average.desc">Top Rated</option><option value="primary_release_date.desc">Newest</option><option value="revenue.desc">Highest Grossing</option></select>
    <select class="browse-select" id="mYear" onchange="loadMovies()"><option value="">All Years</option></select>
  </div>
  <div class="browse-grid" id="mGrid"></div>
  <div class="load-more"><button onclick="moreMovies()">Load More</button></div>
</div>
<div class="browse-page" id="tvPage">
  <div class="browse-top"><h1>TV Shows</h1><p>Binge-worthy series</p></div>
  <div class="genre-scroll" id="tGenres"></div>
  <div class="browse-filters">
    <select class="browse-select" id="tSort" onchange="loadTV()"><option value="popularity.desc">Popular</option><option value="vote_average.desc">Top Rated</option><option value="first_air_date.desc">Newest</option></select>
  </div>
  <div class="browse-grid" id="tGrid"></div>
  <div class="load-more"><button onclick="moreTV()">Load More</button></div>
</div>
<div class="wl-page" id="wlPage">
  <div class="wl-head"><h1>My List</h1></div>
  <div class="wl-count" id="wlCount">0 titles</div>
  <div class="wl-tabs">
    <div class="wl-tab active" onclick="setWLFilter('all',this)">All</div>
    <div class="wl-tab" onclick="setWLFilter('movie',this)">Movies</div>
    <div class="wl-tab" onclick="setWLFilter('tv',this)">TV Shows</div>
  </div>
  <div id="wlContent"></div>
</div>

<!-- BACK TO TOP -->
<button class="btt" id="btt" onclick="window.scrollTo({top:0,behavior:'smooth'})">
  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M18 15l-6-6-6 6"/></svg>
</button>

<!-- TOAST -->
<div class="toast-zone" id="toastZone"></div>

<script>
// ===== CONFIG =====
const AK='2b834d5234781ad70bd646922e9ddd18',BASE='https://api.themoviedb.org/3',IMG='https://image.tmdb.org/t/p/',PH='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="450"><rect fill="%2314141f" width="300" height="450"/><text x="150" y="230" text-anchor="middle" fill="%234b5563" font-size="14" font-family="sans-serif">No Image</text></svg>';
const firebaseConfig={apiKey:"AIzaSyDtcGPY2iCh4SsjFIid_H0lwMfIj9ocN8I",authDomain:"movies-2b6dd.firebaseapp.com",projectId:"movies-2b6dd",storageBucket:"movies-2b6dd.firebasestorage.app",messagingSenderId:"229804615049",appId:"1:229804615049:web:5d438b81c71137d0c3ad58"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(),db=firebase.firestore();

// ===== STATE =====
let user=null,watchlist=[],ratings={},heroItems=[],heroIdx=0,heroTimer=null,searchFilt='multi',searchTO=null,mPg=1,tPg=1,mGenre='',tGenre='',cdIntervals=[],wlFilter='all',searchHistory=[];

// ===== TMDB FETCH =====
async function tmdb(p,params={}){const u=new URL(`${BASE}${p}`);u.searchParams.set('api_key',AK);Object.entries(params).forEach(([k,v])=>{if(v!=null&&v!=='')u.searchParams.set(k,v)});const r=await fetch(u);if(!r.ok)throw new Error(r.status);return r.json()}

// ===== AUTH =====
let authMode='login';
auth.onAuthStateChanged(async u=>{user=u;updateAuthUI();if(u){await Promise.all([loadWatchlist(),loadRatings()]);try{searchHistory=JSON.parse(localStorage.getItem('cv_history_'+u.uid)||'[]')}catch(e){searchHistory=[]}}else{watchlist=[];ratings={};searchHistory=[]}});
function updateAuthUI(){
  const i=user?(user.displayName||user.email||'?')[0].toUpperCase():'?';
  document.getElementById('navAv').textContent=i;
  document.getElementById('ddAv').textContent=i;
  document.getElementById('ddName').textContent=user?user.displayName||'User':'Guest';
  document.getElementById('ddEmail').textContent=user?user.email:'Sign in to continue';
  const da=document.getElementById('ddAuth');
  if(user){da.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>Sign Out';da.className='profile-dd-item danger';da.onclick=()=>{auth.signOut();toggleProfile();toast('Signed out','info')};document.getElementById('ddSignOut').style.display='none';document.getElementById('ddRated').style.display='flex'}
  else{da.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><path d="M10 17l5-5-5-5"/><path d="M15 12H3"/></svg>Sign In';da.className='profile-dd-item';da.onclick=()=>{openAuth();toggleProfile()};document.getElementById('ddRated').style.display='none'}
}
function openAuth(){document.getElementById('authOverlay').classList.add('active')}
function closeAuth(){document.getElementById('authOverlay').classList.remove('active');document.getElementById('authErr').classList.remove('show')}
function switchAuth(m){authMode=m;document.querySelectorAll('.auth-tab').forEach((t,i)=>t.classList.toggle('active',m==='login'?i===0:i===1));document.getElementById('authNameField').style.display=m==='signup'?'block':'none';document.getElementById('authBtn').textContent=m==='login'?'Sign In':'Create Account';document.getElementById('authForgot').style.display=m==='login'?'block':'none';document.getElementById('authErr').classList.remove('show')}
function showAuthErr(msg){document.getElementById('authErrText').textContent=msg;document.getElementById('authErr').classList.add('show')}
async function handleAuth(){
  const email=document.getElementById('authEmail').value.trim(),pass=document.getElementById('authPass').value,name=document.getElementById('authName').value.trim(),btn=document.getElementById('authBtn');
  if(!email||!pass)return showAuthErr('Please fill in all fields');
  btn.disabled=true;btn.textContent='Please wait...';
  try{
    if(authMode==='login'){await auth.signInWithEmailAndPassword(email,pass)}
    else{if(!name)return showAuthErr('Please enter your name');const c=await auth.createUserWithEmailAndPassword(email,pass);await c.user.updateProfile({displayName:name});await db.collection('users').doc(c.user.uid).set({name,email,created:firebase.firestore.FieldValue.serverTimestamp()})}
    closeAuth();toast(authMode==='login'?'Welcome back!':'Account created!','success');
  }catch(e){const m={'auth/email-already-in-use':'Email already in use','auth/wrong-password':'Incorrect password','auth/user-not-found':'No account found','auth/weak-password':'Password must be 6+ characters','auth/invalid-email':'Invalid email address','auth/invalid-credential':'Invalid email or password'};showAuthErr(m[e.code]||e.message)}
  finally{btn.disabled=false;btn.textContent=authMode==='login'?'Sign In':'Create Account'}
}
async function handleGoogleAuth(){try{const p=new firebase.auth.GoogleAuthProvider();const r=await auth.signInWithPopup(p);if(r.additionalUserInfo?.isNewUser)await db.collection('users').doc(r.user.uid).set({name:r.user.displayName,email:r.user.email,created:firebase.firestore.FieldValue.serverTimestamp()});closeAuth();toast('Signed in with Google!','success')}catch(e){if(e.code!=='auth/popup-closed-by-user')showAuthErr(e.message)}}
function handleProfileAuth(){if(user){auth.signOut();toggleProfile();toast('Signed out','info')}else{openAuth();toggleProfile()}}
function toggleProfile(){document.getElementById('profileDD').classList.toggle('active')}
async function resetPassword(e){e.preventDefault();const email=document.getElementById('authEmail').value.trim();if(!email)return showAuthErr('Enter your email first');try{await auth.sendPasswordResetEmail(email);toast('Password reset email sent!','success')}catch(e){showAuthErr(e.message)}}
document.addEventListener('click',e=>{const dd=document.getElementById('profileDD');if(dd.classList.contains('active')&&!e.target.closest('#profileDD')&&!e.target.closest('#navAv'))dd.classList.remove('active')});

// ===== WATCHLIST =====
async function loadWatchlist(){if(!user)return;try{const s=await db.collection('users').doc(user.uid).collection('watchlist').orderBy('added','desc').get();watchlist=s.docs.map(d=>({id:d.id,...d.data()}))}catch(e){console.error(e)}}
async function toggleWL(item,type,e){
  if(e)e.stopPropagation();
  if(!user)return openAuth();
  const id=`${type}_${item.id}`,exists=watchlist.find(w=>w.id===id);
  try{const ref=db.collection('users').doc(user.uid).collection('watchlist').doc(id);
    if(exists){await ref.delete();watchlist=watchlist.filter(w=>w.id!==id);toast('Removed from list','info')}
    else{const d={tmdbId:item.id,type,title:item.title||item.name||'',poster:item.poster_path||'',rating:item.vote_average||0,year:(item.release_date||item.first_air_date||'').slice(0,4),added:firebase.firestore.FieldValue.serverTimestamp()};await ref.set(d);watchlist.unshift({id,...d});toast('Added to list!','success')}
    refreshWLBtns();
  }catch(e){toast('Error updating list','error')}
}
function inWL(id,type){return watchlist.some(w=>w.id===`${type}_${id}`)}
function refreshWLBtns(){document.querySelectorAll('[data-wl]').forEach(b=>{const[t,i]=b.dataset.wl.split('|');const yes=inWL(parseInt(i),t);b.classList.toggle('in',yes);b.innerHTML=yes?'✓':'+'})}

// ===== RATINGS =====
async function loadRatings(){if(!user)return;try{const s=await db.collection('users').doc(user.uid).collection('ratings').get();ratings={};s.docs.forEach(d=>ratings[d.id]=d.data().score)}catch(e){console.error(e)}}
let rateTarget=null;
function openRating(id,type,title){
  if(!user)return openAuth();
  rateTarget={id,type,key:`${type}_${id}`};
  document.getElementById('rateTitle').textContent='Rate this';
  document.getElementById('rateSub').textContent=title;
  const stars=document.getElementById('rateStars');
  const current=ratings[rateTarget.key]||0;
  stars.innerHTML='';
  for(let i=1;i<=10;i++){const s=document.createElement('div');s.className=`rate-star ${i<=current?'active':''}`;s.innerHTML='<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>';
    s.onmouseenter=()=>{stars.querySelectorAll('.rate-star').forEach((st,idx)=>st.classList.toggle('active',idx<i))};
    s.onclick=()=>{rateTarget.score=i;stars.querySelectorAll('.rate-star').forEach((st,idx)=>st.classList.toggle('active',idx<i))};
    stars.appendChild(s)}
  stars.onmouseleave=()=>{const sc=rateTarget.score||current;stars.querySelectorAll('.rate-star').forEach((st,idx)=>st.classList.toggle('active',idx<sc))};
  rateTarget.score=current;
  document.getElementById('rateOv').classList.add('active');
}
function closeRating(){document.getElementById('rateOv').classList.remove('active');rateTarget=null}
async function submitRating(){
  if(!rateTarget||!rateTarget.score)return;
  try{await db.collection('users').doc(user.uid).collection('ratings').doc(rateTarget.key).set({score:rateTarget.score,tmdbId:rateTarget.id,type:rateTarget.type,updated:firebase.firestore.FieldValue.serverTimestamp()});
    ratings[rateTarget.key]=rateTarget.score;toast(`Rated ${rateTarget.score}/10!`,'success');closeRating()}catch(e){toast('Error saving rating','error')}
}
async function clearRating(){
  if(!rateTarget)return;
  try{await db.collection('users').doc(user.uid).collection('ratings').doc(rateTarget.key).delete();delete ratings[rateTarget.key];toast('Rating removed','info');closeRating()}catch(e){toast('Error','error')}
}

// ===== SEARCH =====
function openSearch(){document.getElementById('searchOv').classList.add('active');setTimeout(()=>document.getElementById('searchIn').focus(),150);loadTrending();renderSearchHistory()}
function closeSearch(){document.getElementById('searchOv').classList.remove('active');document.getElementById('searchIn').value='';document.getElementById('searchDefault').style.display='block';document.getElementById('searchResultsWrap').style.display='none'}
function setFilter(f,el){searchFilt=f;document.querySelectorAll('.chip').forEach(c=>c.classList.toggle('active',c.dataset.f===f));const q=document.getElementById('searchIn').value.trim();if(q.length>=2)doSearch(q)}
document.getElementById('searchIn').addEventListener('input',e=>{clearTimeout(searchTO);const q=e.target.value.trim();if(q.length<2){document.getElementById('searchDefault').style.display='block';document.getElementById('searchResultsWrap').style.display='none';return}searchTO=setTimeout(()=>doSearch(q),300)});
document.getElementById('searchIn').addEventListener('keydown',e=>{if(e.key==='Enter'){const q=e.target.value.trim();if(q.length>=2){addToHistory(q);doSearch(q)}}});
async function doSearch(q){
  document.getElementById('searchDefault').style.display='none';
  document.getElementById('searchResultsWrap').style.display='block';
  try{const d=await tmdb(`/search/${searchFilt}`,{query:q});const g=document.getElementById('searchGrid');const empty=document.getElementById('searchEmpty');
    if(!d.results.length){g.innerHTML='';empty.style.display='block';return}
    empty.style.display='none';
    g.innerHTML=d.results.slice(0,24).map(r=>{const t=searchFilt==='multi'?(r.media_type||'movie'):searchFilt;return t==='person'?personCard(r):buildCard(r,t)}).join('')}
  catch(e){console.error(e)}
}
async function loadTrending(){try{const d=await tmdb('/trending/all/day');document.getElementById('trendGrid').innerHTML=d.results.slice(0,12).map(r=>buildCard(r,r.media_type)).join('')}catch(e){}}
function addToHistory(q){if(!user)return;searchHistory=searchHistory.filter(h=>h!==q);searchHistory.unshift(q);searchHistory=searchHistory.slice(0,8);localStorage.setItem('cv_history_'+user.uid,JSON.stringify(searchHistory));renderSearchHistory()}
function renderSearchHistory(){const w=document.getElementById('searchHistoryWrap');if(!searchHistory.length){w.innerHTML='';return}
  w.innerHTML=`<div class="search-section-title">Recent Searches</div><div class="search-history">${searchHistory.map((h,i)=>`<div class="search-history-item" onclick="document.getElementById('searchIn').value='${h.replace(/'/g,"\\'")}';doSearch('${h.replace(/'/g,"\\'")}');addToHistory('${h.replace(/'/g,"\\'")}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>${h}<span class="remove" onclick="event.stopPropagation();removeHistory(${i})">✕</span></div>`).join('')}</div>`}
function removeHistory(i){searchHistory.splice(i,1);if(user)localStorage.setItem('cv_history_'+user.uid,JSON.stringify(searchHistory));renderSearchHistory()}

// ===== CARD BUILDER =====
function esc(s){return(s||'').replace(/'/g,"\\'").replace(/"/g,'&quot;')}
function buildCard(item,type,opts={}){
  const t=type||item.media_type||'movie';if(t==='person')return personCard(item);
  const title=item.title||item.name||'';const year=(item.release_date||item.first_air_date||'').slice(0,4);
  const poster=item.poster_path?`${IMG}w342${item.poster_path}`:PH;
  const rating=item.vote_average?item.vote_average.toFixed(1):'';
  const wl=inWL(item.id,t);
  let cls='card';if(opts.wide)cls+=' card-w';if(opts.t10)cls+=' card-t10';
  let h=`<div class="${cls}" onclick="openDetail(${item.id},'${t}')">`;
  if(opts.t10)h+=`<div class="t10-num">${opts.rank}</div>`;
  h+=`<div class="card-img"><img src="${poster}" alt="${esc(title)}" loading="lazy" onerror="this.src='${PH}'">`;
  if(rating&&!opts.t10)h+=`<div class="card-rating"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>${rating}</div>`;
  h+=`</div>`;
  h+=`<button class="card-wl ${wl?'in':''}" data-wl="${t}|${item.id}" onclick="toggleWL({id:${item.id},title:'${esc(title)}',name:'${esc(title)}',poster_path:'${item.poster_path||''}',vote_average:${item.vote_average||0},release_date:'${item.release_date||''}',first_air_date:'${item.first_air_date||''}'},'${t}',event)">${wl?'✓':'+'}</button>`;
  if(!opts.t10)h+=`<div class="card-info"><div class="card-title">${title}</div><div class="card-sub"><span>${year}</span><span class="dot"></span><span>${t==='tv'?'TV':'Movie'}</span></div></div>`;
  h+=`</div>`;return h;
}
function personCard(item){
  const photo=item.profile_path?`${IMG}w185${item.profile_path}`:PH;
  return `<div class="card" onclick="openPerson(${item.id})"><div class="card-img"><img src="${photo}" alt="${esc(item.name)}" loading="lazy" onerror="this.src='${PH}'"></div><div class="card-info"><div class="card-title">${item.name||''}</div><div class="card-sub">${item.known_for_department||''}</div></div></div>`;
}

// ===== HERO =====
async function initHero(){
  try{const d=await tmdb('/trending/all/day');heroItems=d.results.filter(r=>r.backdrop_path&&(r.media_type==='movie'||r.media_type==='tv')).slice(0,6);
    if(!heroItems.length)return;
    // Pre-build all slides
    const wrap=document.getElementById('heroWrap');
    let slidesHTML='';
    heroItems.forEach((item,i)=>{
      const title=item.title||item.name;const year=(item.release_date||item.first_air_date||'').slice(0,4);
      const rating=item.vote_average?item.vote_average.toFixed(1):'';const genres=(item.genre_ids||[]).slice(0,3).map(gid=>genreMap[gid]||'').filter(Boolean);
      slidesHTML+=`<div class="hero-slide ${i===0?'active':''}" data-idx="${i}">
        <img src="${IMG}original${item.backdrop_path}" alt="" loading="${i===0?'eager':'lazy'}">
        <div class="hero-vignette"></div>
        <div class="hero-content">
          <div class="hero-badge trending"><svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>Trending #${i+1}</div>
          <h1 class="hero-title">${title}</h1>
          <div class="hero-meta">
            ${rating?`<span class="hero-meta-item rating"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>${rating}</span><span class="hero-meta-sep"></span>`:''}<span class="hero-meta-item">${year}</span><span class="hero-meta-sep"></span><span class="hero-meta-item">${item.media_type==='tv'?'TV Series':'Movie'}</span>
          </div>
          ${genres.length?`<div class="hero-genres">${genres.map(g=>`<span class="hero-genre-tag">${g}</span>`).join('')}</div>`:''}
          <p class="hero-desc">${item.overview||''}</p>
          <div class="hero-actions">
            <button class="btn-primary" onclick="openDetail(${item.id},'${item.media_type}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16" fill="currentColor" stroke="none"/></svg>Watch Now</button>
            <button class="btn-glass" onclick="event.stopPropagation();toggleWL({id:${item.id},title:'${esc(title)}',name:'${esc(title)}',poster_path:'${item.poster_path||''}',vote_average:${item.vote_average||0},release_date:'${item.release_date||''}',first_air_date:'${item.first_air_date||''}'},'${item.media_type}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>My List</button>
          </div>
        </div>
      </div>`;
    });
    slidesHTML+=`<div class="hero-progress">${heroItems.map((_,i)=>`<div class="hero-prog-item ${i===0?'active':''}" onclick="goHero(${i})"><div class="hero-prog-fill"></div></div>`).join('')}</div>`;
    wrap.innerHTML=slidesHTML;startHeroTimer();
  }catch(e){console.error('Hero error:',e)}
}
function goHero(i){heroIdx=i;document.querySelectorAll('.hero-slide').forEach((s,idx)=>s.classList.toggle('active',idx===i));document.querySelectorAll('.hero-prog-item').forEach((p,idx)=>{p.classList.remove('active','done');if(idx<i)p.classList.add('done');if(idx===i)p.classList.add('active')});startHeroTimer()}
function startHeroTimer(){clearInterval(heroTimer);heroTimer=setInterval(()=>{heroIdx=(heroIdx+1)%heroItems.length;goHero(heroIdx)},8000)}

// ===== GENRE MAP =====
const genreMap={28:'Action',12:'Adventure',16:'Animation',35:'Comedy',80:'Crime',99:'Documentary',18:'Drama',10751:'Family',14:'Fantasy',36:'History',27:'Horror',10402:'Music',9648:'Mystery',10749:'Romance',878:'Sci-Fi',10770:'TV Movie',53:'Thriller',10752:'War',37:'Western',10759:'Action & Adventure',10762:'Kids',10763:'News',10764:'Reality',10765:'Sci-Fi & Fantasy',10766:'Soap',10767:'Talk',10768:'War & Politics'};

// ===== HOME SECTIONS =====
async function initHome(){
  const secs=[
    {t:'Popular Movies',p:'/movie/popular',type:'movie',icon:'🎬'},
    {t:'Top 10 This Week',p:'/trending/movie/week',type:'movie',t10:true,icon:'🔥'},
    {t:'Popular TV Shows',p:'/tv/popular',type:'tv',icon:'📺'},
    {t:'Now Playing',p:'/movie/now_playing',type:'movie',icon:'🎞️'},
    {t:'Upcoming Movies',p:'/movie/upcoming',type:'movie',icon:'🗓️'},
    {t:'Top Rated Movies',p:'/movie/top_rated',type:'movie',icon:'⭐'},
    {t:'Airing Today',p:'/tv/airing_today',type:'tv',icon:'📡'},
    {t:'Top Rated TV',p:'/tv/top_rated',type:'tv',icon:'🏆'},
    {t:'Trending This Week',p:'/trending/all/week',type:'multi',wide:true,icon:'📈'},
  ];
  let html='';
  secs.forEach(s=>{const rid=s.p.replace(/\//g,'_');
    html+=`<div class="section reveal"><div class="section-head"><h2 class="section-title"><span>${s.icon}</span> ${s.t}</h2><button class="section-see-all" onclick="showPage('${s.type==='tv'?'tv':'movies'}')">See All<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M9 18l6-6-6-6"/></svg></button></div><div class="row" id="row${rid}">${Array(8).fill('<div class="card" style="width:155px"><div class="card-img skel" style="aspect-ratio:2/3"></div></div>').join('')}</div></div>`;
  });
  document.getElementById('homeRows').innerHTML=html;
  initScrollReveal();
  await Promise.allSettled(secs.map(async s=>{
    try{const d=await tmdb(s.p);const items=d.results.slice(0,s.t10?10:20);const el=document.getElementById(`row${s.p.replace(/\//g,'_')}`);
      if(el)el.innerHTML=items.map((item,i)=>{const t=s.type==='multi'?(item.media_type||'movie'):s.type;return s.t10?buildCard(item,t,{t10:true,rank:i+1}):s.wide?buildCard(item,t,{wide:true}):buildCard(item,t)}).join('')}catch(e){}
  }));
}

// ===== SCROLL REVEAL =====
function initScrollReveal(){
  const obs=new IntersectionObserver((entries)=>{entries.forEach(e=>{if(e.isIntersecting){e.target.classList.add('visible');obs.unobserve(e.target)}})},{threshold:.1,rootMargin:'0px 0px -50px 0px'});
  document.querySelectorAll('.reveal').forEach(el=>obs.observe(el));
}

// ===== DETAIL =====
async function openDetail(id,type){
  const ov=document.getElementById('detailOv'),ct=document.getElementById('detailContent');
  ov.classList.add('active');document.body.style.overflow='hidden';
  ct.innerHTML='<div style="display:flex;align-items:center;justify-content:center;min-height:100vh"><div class="loader-text">Loading...</div></div>';
  cdIntervals.forEach(clearInterval);cdIntervals=[];
  try{
    const[det,cred,vids,sim,revs]=await Promise.all([tmdb(`/${type}/${id}`,{append_to_response:'external_ids,content_ratings,release_dates,watch/providers,keywords,recommendations'}),tmdb(`/${type}/${id}/credits`),tmdb(`/${type}/${id}/videos`),tmdb(`/${type}/${id}/similar`),tmdb(`/${type}/${id}/reviews`)]);
    const title=det.title||det.name||'';const year=(det.release_date||det.first_air_date||'').slice(0,4);
    const back=det.backdrop_path?`${IMG}original${det.backdrop_path}`:'';const poster=det.poster_path?`${IMG}w500${det.poster_path}`:PH;
    const rat=det.vote_average?det.vote_average.toFixed(1):'N/A';
    const rt=det.runtime?`${Math.floor(det.runtime/60)}h ${det.runtime%60}m`:(det.episode_run_time?.length?`${det.episode_run_time[0]}m/ep`:'');
    const genres=(det.genres||[]).map(g=>g.name);const cert=getCert(det,type);
    const dir=cred.crew?.find(c=>c.job==='Director');
    const trailer=vids.results?.find(v=>v.type==='Trailer'&&v.site==='YouTube')||vids.results?.find(v=>v.site==='YouTube');
    const wl=inWL(id,type);const myRating=ratings[`${type}_${id}`];
    const providers=det['watch/providers']?.results?.US||det['watch/providers']?.results?.IN;
    const recs=det.recommendations?.results||sim.results||[];

    // COUNTDOWN
    let cdHTML='';
    if(type==='tv'&&det.next_episode_to_air){const nd=new Date(det.next_episode_to_air.air_date);if(nd>new Date()){
      cdHTML=`<div class="countdown"><div class="countdown-label">Next Episode — S${det.next_episode_to_air.season_number}E${det.next_episode_to_air.episode_number}${det.next_episode_to_air.name?` "${det.next_episode_to_air.name}"`:''}</div><div class="countdown-grid"><div class="cd-unit"><div class="cd-num" id="cd_d_${id}">--</div><div class="cd-txt">Days</div></div><div class="cd-unit"><div class="cd-num" id="cd_h_${id}">--</div><div class="cd-txt">Hours</div></div><div class="cd-unit"><div class="cd-num" id="cd_m_${id}">--</div><div class="cd-txt">Min</div></div><div class="cd-unit"><div class="cd-num" id="cd_s_${id}">--</div><div class="cd-txt">Sec</div></div></div></div>`;
    }}

    // SEASONS
    let seasHTML='';
    if(type==='tv'&&det.seasons?.length){const vs=det.seasons.filter(s=>s.season_number>0);
      seasHTML=`<div style="margin-bottom:32px"><div class="d-sec-title">Episodes</div><div class="season-tabs">${vs.map((s,i)=>`<div class="s-tab ${i===0?'active':''}" onclick="loadSeason(${id},${s.season_number},this)">${s.name}</div>`).join('')}</div><div class="ep-list" id="epList_${id}"><div class="skel" style="height:80px;width:100%"></div></div></div>`}

    // VIDEOS
    const allVids=(vids.results||[]).filter(v=>v.site==='YouTube').slice(0,10);
    let vidsHTML='';if(allVids.length){vidsHTML=`<div style="margin-bottom:32px"><div class="d-sec-title">Videos & Trailers</div><div class="vid-scroll">${allVids.map(v=>`<div class="vid-card" onclick="playTrailer('${v.key}')"><div class="vid-thumb"><img src="https://img.youtube.com/vi/${v.key}/mqdefault.jpg" alt="${esc(v.name)}" loading="lazy"><div class="vid-play"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg></div></div><div class="vid-name">${v.name}</div><div class="vid-type">${v.type||''}</div></div>`).join('')}</div></div>`}

    // CAST
    const cast=(cred.cast||[]).slice(0,20);
    let castHTML='';if(cast.length){castHTML=`<div style="margin-bottom:32px"><div class="d-sec-title">Cast</div><div class="cast-scroll">${cast.map(c=>`<div class="cast-item" onclick="openPerson(${c.id})"><div class="cast-pic">${c.profile_path?`<img src="${IMG}w185${c.profile_path}" alt="${esc(c.name)}" loading="lazy">`:''}</div><div class="cast-name">${c.name}</div><div class="cast-char">${c.character||''}</div></div>`).join('')}</div></div>`}

    // REVIEWS
    const revList=(revs.results||[]).slice(0,4);
    let revsHTML='';if(revList.length){revsHTML=`<div style="margin-bottom:32px"><div class="d-sec-title">Reviews</div>${revList.map(r=>`<div class="review"><div class="review-top"><div class="review-av">${(r.author||'?')[0].toUpperCase()}</div><div><div class="review-author">${r.author}</div><div class="review-date">${r.created_at?new Date(r.created_at).toLocaleDateString():''}</div></div>${r.author_details?.rating?`<div class="review-score"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>${r.author_details.rating}</div>`:''}</div><div class="review-body">${r.content||''}</div></div>`).join('')}</div>`}

    // SIMILAR
    const simItems=recs.slice(0,14);
    let simHTML='';if(simItems.length){simHTML=`<div style="margin-bottom:32px"><div class="d-sec-title">More Like This</div><div class="similar-row">${simItems.map(s=>buildCard(s,type)).join('')}</div></div>`}

    // PROVIDERS
    let provHTML='';
    if(providers?.flatrate?.length){provHTML=`<div class="stat-card"><div class="stat-label">Stream On</div><div class="stat-val providers">${providers.flatrate.slice(0,5).map(p=>`<img src="${IMG}w45${p.logo_path}" alt="${esc(p.provider_name)}" title="${esc(p.provider_name)}">`).join('')}</div></div>`}

    // KEYWORDS
    const kws=det.keywords?.keywords||det.keywords?.results||[];
    let kwHTML='';if(kws.length){kwHTML=`<div style="margin-bottom:32px;display:flex;flex-wrap:wrap;gap:6px">${kws.slice(0,15).map(k=>`<span class="dtag" style="font-size:.72rem;cursor:pointer" onclick="event.stopPropagation()">${k.name}</span>`).join('')}</div>`}

    // BUILD
    ct.innerHTML=`
      ${back?`<div class="detail-back"><img src="${back}" alt=""><div class="detail-back-grad"></div></div>`:'<div style="height:var(--nav-h)"></div>'}
      <div class="detail-inner">
        <div class="detail-top">
          <div class="detail-poster"><img src="${poster}" alt="${esc(title)}"></div>
          <div class="detail-head">
            <h1 class="detail-title">${title}</h1>
            ${det.tagline?`<p class="detail-tagline">"${det.tagline}"</p>`:''}
            <div class="detail-tags">
              <span class="dtag gold"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>${rat}</span>
              <span class="dtag">${year}</span>
              ${rt?`<span class="dtag">${rt}</span>`:''}
              ${cert?`<span class="dtag">${cert}</span>`:''}
              ${genres.map(g=>`<span class="dtag">${g}</span>`).join('')}
            </div>
            <div class="detail-btns">
              ${trailer?`<button class="btn-primary" onclick="playTrailer('${trailer.key}')"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>Play Trailer</button>`:''}
              <button class="dbtn-icon ${wl?'active':''}" data-wl="${type}|${id}" title="Watchlist" onclick="toggleWL({id:${id},title:'${esc(title)}',name:'${esc(title)}',poster_path:'${det.poster_path||''}',vote_average:${det.vote_average||0},release_date:'${det.release_date||''}',first_air_date:'${det.first_air_date||''}'},'${type}',event)">${wl?'✓':'+'}</button>
              <button class="dbtn-icon" title="Rate" onclick="openRating(${id},'${type}','${esc(title)}')">${myRating?`<span style="font-size:.72rem;font-weight:800;color:var(--gold)">${myRating}</span>`:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>'}</button>
              <button class="dbtn-icon" title="Share" onclick="shareItem('${esc(title)}',${id},'${type}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></button>
            </div>
          </div>
        </div>
        ${cdHTML}
        <p class="detail-overview clamped" id="detOv">${det.overview||'No overview available.'}</p>
        ${(det.overview||'').length>280?`<span class="detail-overview-toggle" onclick="document.getElementById('detOv').classList.toggle('clamped');this.textContent=document.getElementById('detOv').classList.contains('clamped')?'Read more':'Show less'">Read more</span>`:''}
        <div class="stats-grid">
          ${det.status?`<div class="stat-card"><div class="stat-label">Status</div><div class="stat-val"><span style="color:${det.status==='Released'||det.status==='Returning Series'?'var(--green2)':'var(--text)'}">${det.status}</span></div></div>`:''}
          ${det.original_language?`<div class="stat-card"><div class="stat-label">Language</div><div class="stat-val">${det.original_language.toUpperCase()}</div></div>`:''}
          ${det.budget?`<div class="stat-card"><div class="stat-label">Budget</div><div class="stat-val money">$${fmt(det.budget)}</div></div>`:''}
          ${det.revenue?`<div class="stat-card"><div class="stat-label">Revenue</div><div class="stat-val money">$${fmt(det.revenue)}</div></div>`:''}
          ${det.budget&&det.revenue?`<div class="stat-card"><div class="stat-label">Profit</div><div class="stat-val" style="color:${det.revenue-det.budget>0?'var(--green2)':'var(--red2)'}">$${fmt(det.revenue-det.budget)}</div></div>`:''}
          ${det.vote_count?`<div class="stat-card"><div class="stat-label">Votes</div><div class="stat-val">${det.vote_count.toLocaleString()}</div></div>`:''}
          ${dir?`<div class="stat-card"><div class="stat-label">Director</div><div class="stat-val">${dir.name}</div></div>`:''}
          ${type==='tv'&&det.number_of_seasons?`<div class="stat-card"><div class="stat-label">Seasons</div><div class="stat-val">${det.number_of_seasons}</div></div>`:''}
          ${type==='tv'&&det.number_of_episodes?`<div class="stat-card"><div class="stat-label">Episodes</div><div class="stat-val">${det.number_of_episodes}</div></div>`:''}
          ${type==='tv'&&det.networks?.length?`<div class="stat-card"><div class="stat-label">Network</div><div class="stat-val">${det.networks.map(n=>n.name).join(', ')}</div></div>`:''}
          ${det.production_companies?.length?`<div class="stat-card"><div class="stat-label">Studio</div><div class="stat-val">${det.production_companies[0].name}</div></div>`:''}
          ${det.homepage?`<div class="stat-card"><div class="stat-label">Website</div><div class="stat-val"><a href="${det.homepage}" target="_blank" rel="noopener" style="color:var(--cyan);font-size:.82rem;word-break:break-all">Visit →</a></div></div>`:''}
          ${provHTML}
        </div>
        ${kwHTML}
        ${vidsHTML}
        ${castHTML}
        ${seasHTML}
        ${revsHTML}
        ${simHTML}
      </div>`;
    if(type==='tv'&&det.next_episode_to_air)startCD(id,det.next_episode_to_air.air_date);
    if(type==='tv'&&det.seasons?.length){const fs=det.seasons.find(s=>s.season_number>0);if(fs)loadEps(id,fs.season_number)}
    ov.scrollTop=0;
  }catch(e){console.error(e);ct.innerHTML='<div style="text-align:center;padding:120px 20px"><p style="font-size:1.1rem;font-weight:600">Failed to load</p><p style="color:var(--text3);margin:8px 0 20px">Please try again</p><button class="btn-primary" onclick="closeDetail()">Close</button></div>'}
}
function closeDetail(){document.getElementById('detailOv').classList.remove('active');document.body.style.overflow='';cdIntervals.forEach(clearInterval);cdIntervals=[]}
function getCert(d,t){if(t==='movie'){const u=d.release_dates?.results?.find(r=>r.iso_3166_1==='US');return u?.release_dates?.[0]?.certification||''}return d.content_ratings?.results?.find(r=>r.iso_3166_1==='US')?.rating||''}
function fmt(n){if(n>=1e9)return(n/1e9).toFixed(1)+'B';if(n>=1e6)return(n/1e6).toFixed(0)+'M';if(n>=1e3)return(n/1e3).toFixed(0)+'K';return n.toString()}
function startCD(id,ds){const tg=new Date(ds).getTime();function up(){const df=tg-Date.now();if(df<=0){const e=document.getElementById(`cd_d_${id}`);if(e)e.parentElement.parentElement.innerHTML='<div style="color:var(--green2);font-size:1rem;font-weight:700">🎉 Now Airing!</div>';return}
  const d=Math.floor(df/864e5),h=Math.floor(df%864e5/36e5),m=Math.floor(df%36e5/6e4),s=Math.floor(df%6e4/1e3);
  const de=document.getElementById(`cd_d_${id}`),he=document.getElementById(`cd_h_${id}`),me=document.getElementById(`cd_m_${id}`),se=document.getElementById(`cd_s_${id}`);
  if(de)de.textContent=String(d).padStart(2,'0');if(he)he.textContent=String(h).padStart(2,'0');if(me)me.textContent=String(m).padStart(2,'0');if(se)se.textContent=String(s).padStart(2,'0')}
  up();cdIntervals.push(setInterval(up,1000))}
async function loadSeason(tid,sn,el){el.parentElement.querySelectorAll('.s-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');await loadEps(tid,sn)}
async function loadEps(tid,sn){const el=document.getElementById(`epList_${tid}`);if(!el)return;el.innerHTML='<div class="skel" style="height:80px;width:100%"></div>';
  try{const d=await tmdb(`/tv/${tid}/season/${sn}`);el.innerHTML=(d.episodes||[]).map(ep=>`<div class="ep-card"><div class="ep-still">${ep.still_path?`<img src="${IMG}w300${ep.still_path}" alt="" loading="lazy">`:''}<div class="ep-num">E${ep.episode_number}</div></div><div class="ep-body"><div class="ep-title">${ep.name||`Episode ${ep.episode_number}`}</div><div class="ep-meta">${ep.air_date?`<span>${new Date(ep.air_date).toLocaleDateString()}</span>`:''}${ep.runtime?`<span>${ep.runtime}m</span>`:''}${ep.vote_average?`<span>⭐ ${ep.vote_average.toFixed(1)}</span>`:''}</div><div class="ep-desc">${ep.overview||''}</div></div></div>`).join('')||'<p style="color:var(--text3);padding:12px">No episodes yet</p>'}
  catch(e){el.innerHTML='<p style="color:var(--text3);padding:12px">Failed to load</p>'}}

// ===== PERSON =====
async function openPerson(id){
  const ov=document.getElementById('personOv'),ct=document.getElementById('personContent');
  ov.classList.add('active');document.body.style.overflow='hidden';
  ct.innerHTML='<div style="text-align:center;padding:100px"><div class="loader-text">Loading...</div></div>';
  try{
    const[p,credits]=await Promise.all([tmdb(`/person/${id}`),tmdb(`/person/${id}/combined_credits`)]);
    const photo=p.profile_path?`${IMG}w500${p.profile_path}`:PH;
    const knownFor=(credits.cast||[]).sort((a,b)=>(b.vote_count||0)-(a.vote_count||0)).slice(0,14);
    ct.innerHTML=`
      <div class="person-top">
        <div class="person-photo"><img src="${photo}" alt="${esc(p.name)}"></div>
        <div>
          <h1 class="person-name">${p.name}</h1>
          <div class="person-dept">${p.known_for_department||''}</div>
          ${p.biography?`<p class="person-bio">${p.biography}</p>`:''}
          <div class="person-stats">
            ${p.birthday?`<div class="person-stat"><strong>Born:</strong> ${new Date(p.birthday).toLocaleDateString()}</div>`:''}
            ${p.place_of_birth?`<div class="person-stat"><strong>From:</strong> ${p.place_of_birth}</div>`:''}
            ${p.deathday?`<div class="person-stat"><strong>Died:</strong> ${new Date(p.deathday).toLocaleDateString()}</div>`:''}
          </div>
        </div>
      </div>
      ${knownFor.length?`<div class="d-sec-title">Known For</div><div class="similar-row">${knownFor.map(k=>buildCard(k,k.media_type||'movie')).join('')}</div>`:''}`;
    ov.scrollTop=0;
  }catch(e){ct.innerHTML='<p style="text-align:center;padding:100px;color:var(--text3)">Failed to load</p>'}
}
function closePerson(){document.getElementById('personOv').classList.remove('active');if(!document.getElementById('detailOv').classList.contains('active'))document.body.style.overflow=''}

// ===== SHARE =====
function shareItem(title,id,type){
  const url=`https://www.themoviedb.org/${type}/${id}`;
  if(navigator.share){navigator.share({title:`CineVerse: ${title}`,url}).catch(()=>{})}
  else{navigator.clipboard?.writeText(url).then(()=>toast('Link copied!','success')).catch(()=>toast('Could not copy link','error'))}
}

// ===== TRAILER =====
function playTrailer(key){document.getElementById('trailerFrame').src=`https://www.youtube.com/embed/${key}?autoplay=1&rel=0`;document.getElementById('trailerOv').classList.add('active')}
function closeTrailer(){document.getElementById('trailerFrame').src='';document.getElementById('trailerOv').classList.remove('active')}

// ===== BROWSE =====
const mGenreList=[{id:28,n:'Action'},{id:12,n:'Adventure'},{id:16,n:'Animation'},{id:35,n:'Comedy'},{id:80,n:'Crime'},{id:99,n:'Documentary'},{id:18,n:'Drama'},{id:10751,n:'Family'},{id:14,n:'Fantasy'},{id:36,n:'History'},{id:27,n:'Horror'},{id:10402,n:'Music'},{id:9648,n:'Mystery'},{id:10749,n:'Romance'},{id:878,n:'Sci-Fi'},{id:53,n:'Thriller'},{id:10752,n:'War'},{id:37,n:'Western'}];
const tGenreList=[{id:10759,n:'Action'},{id:16,n:'Animation'},{id:35,n:'Comedy'},{id:80,n:'Crime'},{id:99,n:'Documentary'},{id:18,n:'Drama'},{id:10751,n:'Family'},{id:10762,n:'Kids'},{id:9648,n:'Mystery'},{id:10765,n:'Sci-Fi'},{id:10768,n:'War & Politics'},{id:37,n:'Western'}];
function initFilters(){
  const yr=document.getElementById('mYear');const cy=new Date().getFullYear();for(let y=cy;y>=1970;y--)yr.innerHTML+=`<option value="${y}">${y}</option>`;
  document.getElementById('mGenres').innerHTML=`<div class="g-pill active" onclick="setMG('',this)">All</div>`+mGenreList.map(g=>`<div class="g-pill" onclick="setMG('${g.id}',this)">${g.n}</div>`).join('');
  document.getElementById('tGenres').innerHTML=`<div class="g-pill active" onclick="setTG('',this)">All</div>`+tGenreList.map(g=>`<div class="g-pill" onclick="setTG('${g.id}',this)">${g.n}</div>`).join('');
}
function setMG(id,el){mGenre=id;el.parentElement.querySelectorAll('.g-pill').forEach(p=>p.classList.remove('active'));el.classList.add('active');mPg=1;loadMovies()}
function setTG(id,el){tGenre=id;el.parentElement.querySelectorAll('.g-pill').forEach(p=>p.classList.remove('active'));el.classList.add('active');tPg=1;loadTV()}
async function loadMovies(append=false){
  if(!append)mPg=1;const sort=document.getElementById('mSort').value,year=document.getElementById('mYear').value;
  const params={sort_by:sort,page:mPg};if(sort==='vote_average.desc')params['vote_count.gte']=200;if(mGenre)params.with_genres=mGenre;if(year)params.primary_release_year=year;
  try{const d=await tmdb('/discover/movie',params);const g=document.getElementById('mGrid');const h=d.results.map(m=>buildCard(m,'movie')).join('');if(append)g.innerHTML+=h;else g.innerHTML=h}catch(e){}}
function moreMovies(){mPg++;loadMovies(true)}
async function loadTV(append=false){
  if(!append)tPg=1;const sort=document.getElementById('tSort').value;
  const params={sort_by:sort,page:tPg};if(sort==='vote_average.desc')params['vote_count.gte']=200;if(tGenre)params.with_genres=tGenre;
  try{const d=await tmdb('/discover/tv',params);const g=document.getElementById('tGrid');const h=d.results.map(t=>buildCard(t,'tv')).join('');if(append)g.innerHTML+=h;else g.innerHTML=h}catch(e){}}
function moreTV(){tPg++;loadTV(true)}

// ===== WATCHLIST PAGE =====
function setWLFilter(f,el){wlFilter=f;el.parentElement.querySelectorAll('.wl-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');renderWL()}
function renderWL(){
  const ct=document.getElementById('wlContent'),cnt=document.getElementById('wlCount');
  const items=wlFilter==='all'?watchlist:watchlist.filter(w=>w.type===wlFilter);
  cnt.textContent=`${items.length} title${items.length!==1?'s':''}`;
  if(!user){ct.innerHTML=`<div class="wl-empty"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4"/><path d="M10 17l5-5-5-5"/><path d="M15 12H3"/></svg><h3>Sign in to see your list</h3><p>Create an account to save movies and shows</p><br><button class="btn-primary" onclick="openAuth()">Sign In</button></div>`;return}
  if(!items.length){ct.innerHTML=`<div class="wl-empty"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M19 21l-7-5-7 5V5a2 2 0 012-2h10a2 2 0 012 2z"/></svg><h3>Your list is empty</h3><p>Start adding movies and shows you want to watch</p></div>`;return}
  ct.innerHTML=`<div class="wl-grid">${items.map(w=>{const poster=w.poster?`${IMG}w342${w.poster}`:PH;return `<div class="card" onclick="openDetail(${w.tmdbId},'${w.type}')"><div class="card-img"><img src="${poster}" alt="${esc(w.title)}" loading="lazy" onerror="this.src='${PH}'"></div><div class="card-info"><div class="card-title">${w.title||''}</div><div class="card-sub"><span>${w.year||''}</span><span class="dot"></span><span>${w.type==='tv'?'TV':'Movie'}</span></div></div></div>`}).join('')}</div>`;
}

// ===== PAGES =====
function showPage(page){
  ['homePage','moviesPage','tvPage','wlPage'].forEach(id=>{document.getElementById(id).style.display='none'});
  document.querySelectorAll('.nav-link,.mob-item[data-page]').forEach(l=>l.classList.toggle('active',l.dataset.page===page));
  switch(page){
    case'home':document.getElementById('homePage').style.display='block';break;
    case'movies':document.getElementById('moviesPage').style.display='block';loadMovies();break;
    case'tv':document.getElementById('tvPage').style.display='block';loadTV();break;
    case'watchlist':document.getElementById('wlPage').style.display='block';renderWL();break;
  }
  window.scrollTo({top:0,behavior:'smooth'});
}
function goHome(){showPage('home')}

// ===== NAV SCROLL =====
let lastScroll=0;
window.addEventListener('scroll',()=>{
  const y=window.scrollY;
  document.getElementById('navbar').classList.toggle('scrolled',y>60);
  document.getElementById('btt').classList.toggle('show',y>600);
  lastScroll=y;
},{passive:true});

// ===== TOAST =====
function toast(msg,type='info'){
  const z=document.getElementById('toastZone');const el=document.createElement('div');el.className=`toast ${type}`;
  const icons={success:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>',error:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M15 9l-6 6M9 9l6 6"/></svg>',info:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>'};
  el.innerHTML=`${icons[type]||icons.info}${msg}`;z.appendChild(el);
  setTimeout(()=>{el.style.animation='toast-out .3s forwards';setTimeout(()=>el.remove(),300)},2800);
}

// ===== KEYBOARD =====
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){
    if(document.getElementById('trailerOv').classList.contains('active'))closeTrailer();
    else if(document.getElementById('rateOv').classList.contains('active'))closeRating();
    else if(document.getElementById('personOv').classList.contains('active'))closePerson();
    else if(document.getElementById('detailOv').classList.contains('active'))closeDetail();
    else if(document.getElementById('searchOv').classList.contains('active'))closeSearch();
    else if(document.getElementById('authOverlay').classList.contains('active'))closeAuth();
  }
  if(e.key==='/'&&!e.target.closest('input')&&!document.getElementById('searchOv').classList.contains('active')){e.preventDefault();openSearch()}
});

// ===== SWIPE HERO =====
let touchStartX=0;
document.getElementById('heroWrap').addEventListener('touchstart',e=>{touchStartX=e.touches[0].clientX},{passive:true});
document.getElementById('heroWrap').addEventListener('touchend',e=>{const diff=touchStartX-e.changedTouches[0].clientX;if(Math.abs(diff)>50){if(diff>0)goHero((heroIdx+1)%heroItems.length);else goHero((heroIdx-1+heroItems.length)%heroItems.length)}},{passive:true});

// ===== INIT =====
async function init(){
  try{await Promise.all([initHero(),initHome()]);initFilters()}catch(e){console.error(e)}
  setTimeout(()=>document.getElementById('loader').classList.add('hidden'),2000);
}
init();
</script>
</body>
</html>
